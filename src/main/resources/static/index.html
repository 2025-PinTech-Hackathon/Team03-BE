<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Socket.IO í€˜ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2.3.0/dist/socket.io.js"></script>

</head>
<body>
<h2>ğŸ”Œ WebSocket ì—°ê²° ìƒíƒœ: <span id="status">ì—°ê²° ì•ˆ ë¨</span></h2>

<label>ğŸ” JWT í† í°: <input id="tokenInput" size="80" /></label><br />
<button onclick="connect()">Socket.IO ì—°ê²°</button>

<ul id="messages"></ul>

<script>
    let socket;

    function connect() {
        const token = document.getElementById("tokenInput").value;

        if (!token) {
            alert("JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        socket = io("http://localhost:9092", {
            query: { token: token },
            transports: ["websocket"]
        });

        socket.on("connect", () => {
            document.getElementById("status").innerText = "âœ… ì—°ê²°ë¨";
            console.log("ğŸ”Œ ì—°ê²° ì„±ê³µ:", socket.id);
        });

        socket.on("quest", (data) => {
            const li = document.createElement("li");
            li.innerText = `ğŸ“¥ í€˜ìŠ¤íŠ¸ ë„ì°©: ${data.title} (ë³´ìƒ: ${data.reward}ì›)`;
            document.getElementById("messages").appendChild(li);
        });

        socket.on("disconnect", () => {
            document.getElementById("status").innerText = "âŒ ì—°ê²° ëŠê¹€";
            console.log("ğŸ”Œ ì—°ê²° ì¢…ë£Œ");
        });

        socket.on("connect_error", (err) => {
            document.getElementById("status").innerText = "âš ï¸ ì—°ê²° ì‹¤íŒ¨";
            console.error("ì—°ê²° ì˜¤ë¥˜:", err.message);
        });

        socket.on("transaction-blocked", (data) => {
            console.log("âŒ ê±°ë˜ ì°¨ë‹¨ ì•Œë¦¼ ìˆ˜ì‹ :", data);

            // ì˜ˆ: alert ë˜ëŠ” í™”ë©´ì— í‘œì‹œ
            const li = document.createElement("li");
            li.innerText = `âŒ ê±°ë˜ ì°¨ë‹¨: ${data.reason} (${data.amount}ì› / ${data.merchantName})`;
            document.getElementById("messages").appendChild(li);
        });
    }
</script>
</body>
</html>
